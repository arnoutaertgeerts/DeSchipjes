<!-- External plugins -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.17/require.min.js"></script>

<script type="text/javascript">
    requirejs.config({
        paths: {
            'highstock': "http://code.highcharts.com/stock/highstock",
            'standalone': "http://code.highcharts.com/adapters/standalone-framework",
            'export': "http://code.highcharts.com/stock/modules/exporting",

            'angular': "https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.min",
            'underscore': "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min",
            'animate': "https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular-animate.min",
            'aria': "https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular-aria.min",
            'material': "https://cdnjs.cloudflare.com/ajax/libs/angular-material/0.9.4/angular-material.min",
            'accordion': "https://cdn.rawgit.com/LukaszWatroba/v-accordion/v1.2.3/dist/v-accordion.min",
            'json-editor': "https://cdn.rawgit.com/arnoutaertgeerts/jsoneditor/v4.2.0/dist/jsoneditor",
            'select': "https://cdn.rawgit.com/arnoutaertgeerts/angular-multi-select/master/isteven-multi-select"
        },

        shim: {
            'highstock': {
                deps: ['standalone'],
                exports: 'Highcharts'
            },
            'export': {
                deps: ['highstock']
            },
            'angular': {
                exports: 'angular'
            },
            'underscore': {
                exports: '_'
            },
            'animate': ['angular'],
            'aria': ['angular'],
            'material': ['angular', 'animate', 'aria'],
            'accordion': ['angular'],
            'select': ['angular']
        }
    });
</script>

<!-- Stylesheets -->
<link rel="stylesheet"
      href="https://cdn.rawgit.com/arnoutaertgeerts/angular-multi-select/master/isteven-multi-select.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/0.9.4/angular-material.min.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.rawgit.com/LukaszWatroba/v-accordion/v1.2.3/dist/v-accordion.min.css"/>
<link rel="stylesheet" href="https://cdn.rawgit.com/arnoutaertgeerts/jsoneditor/master/dist/jsoneditor.min.css"/>


<style>
    .md-chips .md-chip-input-container input:focus {
        outline: none;
        border: none;
        box-shadow: none;
    }

    md-input-container .md-input:focus {
        box-shadow: none;
    }

    .jsoneditor td.tree, .jsoneditor td, .jsoneditor tr, .jsoneditor table {
        border: none;
        margin: 0;
    }
</style>

<script type="text/javascript">
    require(['json-editor', 'angular'], function (JSONEditor) {
        var module = angular.module('ng.jsoneditor', []);
        module.constant('ngJsoneditorConfig', {});

        module.directive('ngJsoneditor', ['ngJsoneditorConfig', '$timeout', function (ngJsoneditorConfig, $timeout) {
            var defaults = ngJsoneditorConfig || {};

            return {
                restrict: 'A',
                require: 'ngModel',
                scope: {'options': '=', 'ngJsoneditor': '=', 'preferText': '='},
                link: function ($scope, element, attrs, ngModel) {
                    var editor;

                    if (!angular.isDefined(JSONEditor)) {
                        throw new Error("Please add the jsoneditor.js script first!");
                    }

                    function _createEditor(options) {
                        var settings = angular.extend({}, defaults, options);
                        var theOptions = angular.extend({}, settings, {
                            change: function () {
                                $timeout(function () {
                                    if (editor) {
                                        ngModel.$setViewValue($scope.preferText === true ? editor.getText() : editor.get());

                                        if (settings && settings.hasOwnProperty('change')) {
                                            settings.change();
                                        }
                                    }
                                });
                            }
                        });

                        element.html('');

                        var instance = new JSONEditor(element[0], theOptions);

                        if ($scope.ngJsoneditor instanceof Function) {
                            $timeout(function () {
                                $scope.ngJsoneditor(instance);
                            });
                        }

                        return instance;
                    }

                    $scope.$watch('options', function (newValue, oldValue) {
                        for (var k in newValue) {
                            if (newValue.hasOwnProperty(k)) {
                                var v = newValue[k];

                                if (newValue[k] !== oldValue[k]) {
                                    if (k === 'mode') {
                                        editor.setMode(v);
                                    } else if (k === 'name') {
                                        editor.setName(v);
                                    } else { //other settings cannot be changed without re-creating the JsonEditor
                                        editor = _createEditor(newValue);
                                        ngModel.$render();
                                        return;
                                    }
                                }
                            }
                        }
                    }, true);

                    $scope.$on('$destroy', function () {
                        //remove jsoneditor?
                    });

                    ngModel.$render = function () {
                        if (($scope.preferText === true) && !angular.isObject(ngModel.$viewValue)) {
                            editor.setText(ngModel.$viewValue || '{}');
                        } else {
                            editor.set(ngModel.$viewValue || {});
                        }
                    };

                    editor = _createEditor($scope.options);
                }
            };
        }]);
    })
</script>

<script type="text/javascript">
    //inject:js
    require([
        'highstock',
        'angular',
        'underscore',
        'animate',
        'aria',
        'material',
        'export',
        'accordion',
        'select'
    ], function () {

        //Count the number of apps / charts on the page
        if (window.counter == undefined) {
            window.counter = 0;
        } else {
            window.counter++;
        }

        //Create different containers for the apps and charts
        var chartContainer = document.getElementById("container");
        chartContainer.id = "chart" + window.counter.toString();

        var appContainer = document.getElementById("appid");
        appContainer.id = "app" + window.counter.toString();

        //The angular app
        var app = angular.module('myApp', [
            "ngMaterial",
            "vAccordion",
            "ng.jsoneditor",
            "isteven-multi-select"
        ]);

        app.controller('MyController', ['$scope', function ($scope) {

            var series = [{"data": [[86400000.0, 172.32883794000372], [87300000.0, 178.9573384760879], [88200000.0, 185.02757635060698], [89100000.0, 190.2722338680178], [90000000.0, 194.8178938580677], [90900000.0, 198.68021517473971], [91800000.0, 201.80225672671804], [92700000.0, 204.4645131323923], [93600000.0, 206.89260641648434], [94500000.0, 114.15242378308903], [95400000.0, 0.0], [96300000.0, 0.0], [97200000.0, 0.0], [98100000.0, 55.52846561485785], [99000000.0, 104.13763043042854], [99900000.0, 6332.642494827509], [100800000.0, 0.0], [101700000.0, 0.0], [102600000.0, 0.0], [103500000.0, 218.51540654152632], [104400000.0, 1448.250324845314], [105300000.0, 7705.76682639122], [106200000.0, 446.2679342031479], [107100000.0, 0.0], [108000000.0, 0.0], [108900000.0, 3547.4649806022644], [109800000.0, 1451.5431501567364], [110700000.0, 0.0], [111600000.0, 0.0], [112500000.0, 0.0], [113400000.0, 0.0], [114300000.0, 212.2623901963234], [115200000.0, 0.0], [116100000.0, 0.0], [117000000.0, 2136.4654508531094], [117900000.0, 322.58378478884697], [118800000.0, 0.0], [119700000.0, 2591.6680207252502], [120600000.0, 1950.9620505273342], [121500000.0, 25.329145431518555], [122400000.0, 0.0], [123300000.0, 359.0158087015152], [124200000.0, 0.0], [125100000.0, 0.0], [126000000.0, 1874.8005530834198], [126900000.0, 0.0], [127800000.0, 0.0], [128700000.0, 1291.4501127004623], [129600000.0, 799.4884444475174], [130500000.0, 11405.882996082306], [131400000.0, 8981.349309444427], [132300000.0, 4921.5698029994965], [133200000.0, 179.84148636460304], [134100000.0, 2926.4554007053375], [135000000.0, 0.0], [135900000.0, 0.0], [136800000.0, 0.0], [137700000.0, 0.0], [138600000.0, 0.0], [139500000.0, 0.0], [140400000.0, 85.7648754119873], [141300000.0, 2682.2148466706276], [142200000.0, 7.991978727281094], [143100000.0, 0.0], [144000000.0, 1631.4432398453355], [144900000.0, 1783.9748404622078], [145800000.0, 0.0], [146700000.0, 0.0], [147600000.0, 0.0], [148500000.0, 0.0], [149400000.0, 0.0], [150300000.0, 1846.0634388923645], [151200000.0, 1077.49683958292], [152100000.0, 0.0], [153000000.0, 0.0], [153900000.0, 1613.4410015940666], [154800000.0, 78.0317453625612], [155700000.0, 0.0], [156600000.0, 0.0], [157500000.0, 0.0], [158400000.0, 0.0], [159300000.0, 0.0], [160200000.0, 3641.6172311902046], [161100000.0, 0.0], [162000000.0, 0.0], [162900000.0, 0.0], [163800000.0, 0.0], [164700000.0, 0.0], [165600000.0, 0.0], [166500000.0, 0.0], [167400000.0, 0.0], [168300000.0, 0.0], [169200000.0, 0.0], [170100000.0, 0.0], [171000000.0, 0.0], [171900000.0, 0.0]], "name": "DHW heat flow", "display": true}, {"data": [[86400000.0, 39576046.320996284], [87300000.0, 39786634.661727905], [88200000.0, 39995877.97036743], [89100000.0, 40203792.54535866], [90000000.0, 40410969.569244385], [90900000.0, 40617566.43014717], [91800000.0, 40823717.0110302], [92700000.0, 41029756.284137726], [93600000.0, 41235841.29898262], [94500000.0, 41436924.5956192], [95400000.0, 41655089.062763214], [96300000.0, 41874766.2392292], [97200000.0, 42095330.85783386], [98100000.0, 42316617.205631256], [99000000.0, 42538969.26194382], [99900000.0, 42850043.33276367], [100800000.0, 43269947.99963379], [101700000.0, 43703504.332977295], [102600000.0, 44137736.49990845], [103500000.0, 44571449.33312988], [104400000.0, 45005204.99990845], [105300000.0, 45424679.20007324], [106200000.0, 45836381.33343506], [107100000.0, 46255648.00036621], [108000000.0, 46675034.50009155], [108900000.0, 47094237.999938965], [109800000.0, 47513770.000061035], [110700000.0, 47931628.74996948], [111600000.0, 48352444.399902344], [112500000.0, 48772437.00045776], [113400000.0, 49193636.28588867], [114300000.0, 49609661.33325195], [115200000.0, 50032232.66644287], [116100000.0, 50449177.33392334], [117000000.0, 50868660.0], [117900000.0, 51295276.00024414], [118800000.0, 51714000.70550537], [119700000.0, 52134572.249816895], [120600000.0, 52559394.2857666], [121500000.0, 52978236.00265503], [122400000.0, 53396502.00024414], [123300000.0, 53817274.00024414], [124200000.0, 54239355.997558594], [125100000.0, 54656321.99938965], [126000000.0, 55078494.39996338], [126900000.0, 55505002.80004883], [127800000.0, 55926862.66674805], [128700000.0, 56345807.99987793], [129600000.0, 56777875.33331299], [130500000.0, 57368734.997680664], [131400000.0, 57981261.299316406], [132300000.0, 58601112.79992676], [133200000.0, 59230038.306396484], [134100000.0, 59653772.85675049], [135000000.0, 60070706.99951172], [135900000.0, 60491845.33328247], [136800000.0, 60915205.61450195], [137700000.0, 61327355.99996948], [138600000.0, 61748655.25021362], [139500000.0, 62169161.71398926], [140400000.0, 62587715.99951172], [141300000.0, 63005764.00012207], [142200000.0, 63429320.66680908], [143100000.0, 63847617.55541992], [144000000.0, 64266519.99966431], [144900000.0, 64687921.14285278], [145800000.0, 65104425.37539673], [146700000.0, 65522704.55541992], [147600000.0, 65944269.33343506], [148500000.0, 66363159.99975586], [149400000.0, 66783080.50024414], [150300000.0, 67205143.7142334], [151200000.0, 67628016.00024414], [152100000.0, 68046603.5281372], [153000000.0, 68464676.00054932], [153900000.0, 68886314.0], [154800000.0, 69305155.19961548], [155700000.0, 69729871.83361816], [156600000.0, 70131765.27307129], [157500000.0, 70530486.00585938], [158400000.0, 70914894.87475586], [159300000.0, 71285588.84295654], [160200000.0, 71613248.7268982], [161100000.0, 71924774.66619873], [162000000.0, 72227756.17118835], [162900000.0, 72516219.59994507], [163800000.0, 72796642.64221191], [164700000.0, 73059314.51629639], [165600000.0, 73296885.48492432], [166500000.0, 73489992.9995842], [167400000.0, 73640570.39938354], [168300000.0, 73761432.29799652], [169200000.0, 73873294.39996338], [170100000.0, 73950811.62617493], [171000000.0, 74005564.26174927], [171900000.0, 74059115.77758789]], "name": "District heating losses", "display": true}, {"data": [[86400000.0, 235.17015223251656], [87300000.0, 233.2776432512328], [88200000.0, 231.741588877514], [89100000.0, 230.62535236612894], [90000000.0, 229.7949334688019], [90900000.0, 229.2295745354495], [91800000.0, 228.96154445322463], [92700000.0, 228.93954783111985], [93600000.0, 229.07600620528683], [94500000.0, 1187.0240507125854], [95400000.0, 408.36257314682007], [96300000.0, 244.6468625771813], [97200000.0, 245.53643610700965], [98100000.0, 246.48562420671806], [99000000.0, 247.49421002389863], [99900000.0, 8715.709976196289], [100800000.0, 2536.6302032470703], [101700000.0, 1189.5127110481262], [102600000.0, 2117.517044067383], [103500000.0, 2705.8576049804688], [104400000.0, 3820.1571049690247], [105300000.0, 11999.738258361816], [106200000.0, 5396.153350830078], [107100000.0, 1710.5237731933594], [108000000.0, 3321.9150619506836], [108900000.0, 7663.606460571289], [109800000.0, 5266.003416061401], [110700000.0, 1665.9749374389648], [111600000.0, 3534.707229614258], [112500000.0, 2752.8963584899902], [113400000.0, 2781.7814178466797], [114300000.0, 4291.593566894531], [115200000.0, 2669.392333984375], [116100000.0, 2129.6201169490814], [117000000.0, 5924.696451812983], [117900000.0, 3585.6877479553223], [118800000.0, 2793.601996421814], [119700000.0, 6273.549583435059], [120600000.0, 5228.409454345703], [121500000.0, 3421.6830883026123], [122400000.0, 3116.545669555664], [123300000.0, 3718.4071655273438], [124200000.0, 1786.5305662155151], [125100000.0, 1330.8959732055664], [126000000.0, 4572.85368347168], [126900000.0, 1872.3946685791016], [127800000.0, 1422.95751953125], [128700000.0, 4532.327472686768], [129600000.0, 3389.5175170898438], [130500000.0, 13233.66996383667], [131400000.0, 10094.92082977295], [132300000.0, 5664.677139282227], [133200000.0, 703.4785346984863], [134100000.0, 7965.513401031494], [135000000.0, 2006.411880493164], [135900000.0, 2101.72993850708], [136800000.0, 1741.5139536857605], [137700000.0, 2945.205955505371], [138600000.0, 2357.215980529785], [139500000.0, 3038.3354415893555], [140400000.0, 3692.604721069336], [141300000.0, 6412.917482376099], [142200000.0, 3158.847854614258], [143100000.0, 1493.236029677093], [144000000.0, 5162.234376907349], [144900000.0, 5146.486785888672], [145800000.0, 1650.4881496429443], [146700000.0, 2819.6846809387207], [147600000.0, 3130.6935958862305], [148500000.0, 2699.3108673095703], [149400000.0, 3158.4962768554688], [150300000.0, 5396.976577758789], [151200000.0, 4361.832530975342], [152100000.0, 2550.116371154785], [153000000.0, 2972.320755004883], [153900000.0, 5050.060020446777], [154800000.0, 2883.5395078659058], [155700000.0, 1338.1267166137695], [156600000.0, 1605.7891693115234], [157500000.0, 439.45938140153885], [158400000.0, 419.2125442624092], [159300000.0, 400.12665905058384], [160200000.0, 6370.6108322143555], [161100000.0, 1069.151777267456], [162000000.0, 917.5940679907799], [162900000.0, 1206.8833255767822], [163800000.0, 404.37418365478516], [164700000.0, 315.0884390324354], [165600000.0, 242.9352395683527], [166500000.0, 194.410072311759], [167400000.0, 157.47399002313614], [168300000.0, 126.31128437817097], [169200000.0, 97.16362771391869], [170100000.0, 75.84128134697676], [171000000.0, 60.70002202689648], [171900000.0, 45.93632888793945]], "name": "Total heat flow", "display": true}, {"data": [[86400000.0, 62.841314292512834], [87300000.0, 54.320304775144905], [88200000.0, 46.71401252690703], [89100000.0, 40.353118498111144], [90000000.0, 34.97703961073421], [90900000.0, 30.549359360709786], [91800000.0, 27.15928772650659], [92700000.0, 24.47503469872754], [93600000.0, 22.18339978880249], [94500000.0, 1072.8716269294964], [95400000.0, 638.4518143400201], [96300000.0, 408.6058223245782], [97200000.0, 273.109255986521], [98100000.0, 190.9571585918602], [99000000.0, 143.3565795934701], [99900000.0, 2383.06748136878], [100800000.0, 2883.1942822635174], [101700000.0, 2543.219359030947], [102600000.0, 2546.360125541687], [103500000.0, 2487.3421984389424], [104400000.0, 2371.9067801237106], [105300000.0, 4293.971431970596], [106200000.0, 4949.88541662693], [107100000.0, 4484.310057282448], [108000000.0, 4133.307983130217], [108900000.0, 4116.141479969025], [109800000.0, 3814.460265904665], [110700000.0, 3909.3070219159126], [111600000.0, 3725.5212671756744], [112500000.0, 3564.503111600876], [113400000.0, 3564.275981426239], [114300000.0, 4079.331176698208], [115200000.0, 3513.2045483589172], [116100000.0, 3758.9532477855682], [117000000.0, 3788.231000959873], [117900000.0, 3263.1039631664753], [118800000.0, 3522.5149245262146], [119700000.0, 3681.8815627098083], [120600000.0, 3277.447403818369], [121500000.0, 3396.3539428710938], [122400000.0, 3350.691284403205], [123300000.0, 3359.3913568258286], [124200000.0, 2780.518967151642], [125100000.0, 2618.1080952882767], [126000000.0, 2698.05313038826], [126900000.0, 2677.0530997514725], [127800000.0, 2712.09210062027], [128700000.0, 3240.8773599863052], [129600000.0, 2590.0290726423264], [130500000.0, 1827.786967754364], [131400000.0, 1113.5715203285217], [132300000.0, 743.1073362827301], [133200000.0, 523.6370483338833], [134100000.0, 5039.058000326157], [135000000.0, 3829.0199570655823], [135900000.0, 2977.4551998972893], [136800000.0, 2501.2068926095963], [137700000.0, 4416.3782142698765], [138600000.0, 3852.2853248268366], [139500000.0, 3284.1695375442505], [140400000.0, 3606.8398456573486], [141300000.0, 3730.702635705471], [142200000.0, 3150.8558758869767], [143100000.0, 3448.9782173633575], [144000000.0, 3530.791137062013], [144900000.0, 3362.511945426464], [145800000.0, 3447.9132812023163], [146700000.0, 3453.663507759571], [147600000.0, 3613.6283772587776], [148500000.0, 3522.9968260228634], [149400000.0, 3387.174347281456], [150300000.0, 3550.9131388664246], [151200000.0, 3284.3356913924217], [152100000.0, 3221.372550010681], [153000000.0, 3679.385009072721], [153900000.0, 3436.6190188527107], [154800000.0, 2805.5077625033446], [155700000.0, 2766.862751364708], [156600000.0, 2002.0531454086304], [157500000.0, 1314.6340101361275], [158400000.0, 874.5358369350433], [159300000.0, 598.5206372141838], [160200000.0, 2728.993601024151], [161100000.0, 2346.4531796872616], [162000000.0, 1511.2368549071252], [162900000.0, 1980.401894055307], [163800000.0, 1569.2307477146387], [164700000.0, 1649.6837997175753], [165600000.0, 994.7669285647571], [166500000.0, 638.2401387579739], [167400000.0, 446.7730726003647], [168300000.0, 330.40105578303337], [169200000.0, 227.1460754685104], [170100000.0, 172.40135283675045], [171000000.0, 138.4617610182613], [171900000.0, 105.46609687805176]], "name": "Heating heat flow", "display": true}, {"data": [[86400000.0, 220772506.24047852], [87300000.0, 220983096.06640625], [88200000.0, 221192336.3984375], [89100000.0, 221400253.09127808], [90000000.0, 221607429.29156494], [90900000.0, 221814023.67025757], [91800000.0, 222020181.69180298], [92700000.0, 222226222.28625488], [93600000.0, 222432305.40646362], [94500000.0, 224470665.6513672], [95400000.0, 224711098.0366211], [96300000.0, 224935476.231781], [97200000.0, 225156039.53833008], [98100000.0, 225377322.31350708], [99000000.0, 225599665.44857788], [99900000.0, 230507151.9921875], [100800000.0, 235275008.0048828], [101700000.0, 237880009.3310547], [102600000.0, 240394828.00048828], [103500000.0, 242896704.0], [104400000.0, 245349455.99951172], [105300000.0, 252144076.81054688], [106200000.0, 259496618.6669922], [107100000.0, 263742847.99609375], [108000000.0, 267338108.0], [108900000.0, 270928192.0], [109800000.0, 274512015.9980469], [110700000.0, 278625379.9995117], [111600000.0, 282043923.19921875], [112500000.0, 285519797.33251953], [113400000.0, 289255026.28515625], [114300000.0, 293844031.99609375], [115200000.0, 296738058.66796875], [116100000.0, 301051978.66015625], [117000000.0, 304466912.0019531], [117900000.0, 307326229.3378906], [118800000.0, 311360747.28808594], [119700000.0, 314968235.9941406], [120600000.0, 317984265.1328125], [121500000.0, 321900051.0], [122400000.0, 325196992.0024414], [123300000.0, 328603712.0078125], [124200000.0, 331038645.3251953], [125100000.0, 333539296.00097656], [126000000.0, 336028070.3964844], [126900000.0, 339054566.4003906], [127800000.0, 342128245.3310547], [128700000.0, 345749759.9980469], [129600000.0, 347670431.99902344], [130500000.0, 360058543.91015625], [131400000.0, 371077113.328125], [132300000.0, 378227865.6035156], [133200000.0, 381508238.77441406], [134100000.0, 393210180.54296875], [135000000.0, 396799472.0019531], [135900000.0, 398805146.66259766], [136800000.0, 400941382.1821289], [137700000.0, 408055605.33447266], [138600000.0, 411508700.00683594], [139500000.0, 413944475.4277344], [140400000.0, 418003455.99609375], [141300000.0, 421530176.00390625], [142200000.0, 424468021.33203125], [143100000.0, 428617902.2216797], [144000000.0, 432097856.0019531], [144900000.0, 435429851.4267578], [145800000.0, 439373077.99365234], [146700000.0, 442866583.11328125], [147600000.0, 446597248.0004883], [148500000.0, 450084928.00390625], [149400000.0, 453419640.0], [150300000.0, 457098116.5722656], [151200000.0, 460246623.9921875], [152100000.0, 463840943.0605469], [153000000.0, 468108480.00390625], [153900000.0, 471061919.9980469], [154800000.0, 473428985.60131836], [155700000.0, 476301066.6723633], [156600000.0, 477363173.81640625], [157500000.0, 477847056.00146484], [158400000.0, 478231471.78222656], [159300000.0, 478602163.2922363], [160200000.0, 483877602.8984375], [161100000.0, 486547146.6689453], [162000000.0, 487153845.9581299], [162900000.0, 489145299.20336914], [163800000.0, 490315253.7597656], [164700000.0, 492031391.223999], [165600000.0, 492268224.7628174], [166500000.0, 492461199.99957275], [167400000.0, 492611769.6003418], [168300000.0, 492732643.20111084], [169200000.0, 492844511.99975586], [170100000.0, 492922019.51631165], [171000000.0, 492976771.16311646], [171900000.0, 493030325.3331909]], "name": "Total energy use", "display": true}];
            var options = {"chart": {"zoomType": "xy", "type": "line"}, "legend": {"enabled": true}};
            var useHighStock = true;

            //Choose a chart type
            var ChartType = useHighStock ? Highcharts.StockChart : Highcharts.Chart;

            var keys = [];
            angular.forEach(series, function (serie) {
                keys.push({
                    name: serie.name,
                    selected: serie.display
                })
            });

            $scope.keys = keys;
            $scope.selectedItem = null;
            $scope.searchText = null;
            $scope.querySearch = querySearch;
            $scope.keys = keys;
            $scope.selected = {};
            $scope.selected.keys = [];

            $scope.options = null;
            $scope.setOptions = setOptions;

            $scope.$watch('selected.keys', updateSeries, true);

            if (typeof options.chart === "undefined") {
                var chartOptions = {renderTo: chartContainer.id};
            } else {
                var chartOptions = angular.extend(options["chart"], {renderTo: chartContainer.id});
            }

            //Initial rendered series
            var renderedSeries = [];
            options = angular.extend(options, {chart: chartOptions}, {series: renderedSeries});
            var chart = new ChartType(options);

            //JSONEditor object
            $scope.obj = {data: chart.options, options: { mode: 'tree' }};

            //Default highchart colors
            var colors = {};
            colors.available = ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9',
                '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'];
            colors.used = [];

            //Show first series
            $scope.selected.keys = _.filter(series,function (obj) {
                return obj.display == true || obj.display === true
            }).map(function (serie) {
                return {
                    name: serie.name,
                    selected: true
                }
            });

            updateSeries($scope.selected.keys, []);

            function setOptions(options) {
                newChart(angular.extend(chart.options, options), renderedSeries);
                $scope.accordion.toggle(0);
            }

            function querySearch(query) {
                var availableKeys = _.difference($scope.keys, $scope.selected.keys);
                return query ? availableKeys.filter(createFilterFor(query)) : [];
            }

            function createFilterFor(query) {
                var lowercaseQuery = angular.lowercase(query);
                return function filterFn(key) {
                    return (angular.lowercase(key).indexOf(lowercaseQuery) > -1);
                };
            }

            // Update the series
            function updateSeries(newValue, oldValue) {
                newValue = newValue.map(function (element) {
                    return element.name
                });

                oldValue = oldValue.map(function (element) {
                    return element.name
                });

                if (newValue.length > oldValue.length) {
                    var newKeys = _.difference(newValue, oldValue);
                    angular.forEach(newKeys, function (newKey) {
                        var index = findSeries(series, newKey);
                        var newSeries = series[index];
                        addSeries(newSeries);
                    });
                    newChart(chart.options, renderedSeries);

                } else if (newValue.length < oldValue.length) {
                    var removedKeys = _.difference(oldValue, newValue);
                    angular.forEach(removedKeys, function (removedKey) {
                        deleteSeries(removedKey);
                    });

                    newChart(chart.options, renderedSeries)
                }
            }

            function findSeries(series, key) {
                var index = {};

                var arrayLength = series.length;
                for (var i = 0; i < arrayLength; i++) {
                    if (series[i].name == key) {
                        index = i
                    }
                }
                return index
            }

            function newChart(options, series) {
                //Disable animation
                newOptions = angular.extend(options, {series: series});
                newOptions.plotOptions['series'] = {animation: false};

                //Get zoom
                var xExtremes = chart.xAxis[0].getExtremes();

                //Re-plot the chart
                chart.destroy();
                chart = new ChartType(newOptions);

                //Reset the zoom
                chart.xAxis[0].setExtremes(xExtremes.min, xExtremes.max, false, false);

                //Re-draw chart
                chart.redraw();
            }

            function addSeries(newSeries) {
                renderedSeries.push(angular.extend(newSeries, {color: colors.available[0]}));
                colors.used.push(colors.available.splice(0, 1)[0]);
            }

            function deleteSeries(name) {
                var index = findSeries(renderedSeries, name);
                var deletedColor = renderedSeries.splice(index, 1).color;
                var colorIndex = colors.used.indexOf(deletedColor);
                colors.available.push(colors.used.splice(colorIndex, 1)[0]);
            }

        }]);

        angular.bootstrap(appContainer, ['myApp']);
    });
</script>


<div id="appid">

    <div ng-controller="MyController">
        <section flex>
            <div layout="column">
                <div class="md-padding" layout="row" flex>
                    <div flex="80">
                        <isteven-multi-select
                                input-model="keys"
                                output-model="selected.keys"
                                button-label="name"
                                item-label="name"
                                tick-property="selected"
                                max-height="250px"
                                >
                        </isteven-multi-select>
                    </div>
                    <div flex="20" layout-align="end center" layout="row">
                        <md-button ng-click="accordion.toggle(0)">Settings</md-button>
                    </div>
                </div>

                <md-content class="md-padding" flex>
                    <v-accordion class="vAccordion--default" control="accordion">
                        <v-pane>
                            <v-pane-header style="display:none"></v-pane-header>
                            <v-pane-content>
                                <div ng-jsoneditor ng-model="obj.data" options="obj.options"
                                     style="width: 100%; height: 300px;"></div>

                                <md-button class="md-raised md-primary no-padding" style="margin-left: 0;"
                                           ng-click="setOptions(obj.data)">Apply
                                </md-button>
                            </v-pane-content>
                        </v-pane>

                    </v-accordion>
                </md-content>
                <md-content class="md-padding" flex>
                    <div id="container" style="height: 550px; min-width: 310px"></div>
                </md-content>
            </div>
        </section>
    </div>
</div>